{% extends 'core/base.html' %}
{% load static %}
{% load humanize %}

<!-- O <title> da página será o nome do imóvel -->
{% block title %}{{ imovel.titulo }} - Lotus Imobiliária{% endblock %}

{% block content %}

<!-- 1. SEÇÃO DO TÍTULO E LOCALIZAÇÃO -->
<section class="bg-marinho-escuro text-white pt-28 pb-16">
    <div class="container mx-auto px-6 text-center">
        <!-- Título do Imóvel (H1) -->
        <h1 class="font-serif text-4xl md:text-6xl font-bold">
            {{ imovel.titulo }}
        </h1>
        <!-- Localização (Tipo + Bairro) -->
        <p class="mt-4 text-lg md:text-xl max-w-2xl mx-auto text-cinza-claro/80">
            {{ imovel.tipo_imovel.nome|default:'Imóvel' }} em {{ imovel.bairro.nome|default:'Localização Privilegiada' }}
        </p>
    </div>
</section>

<!-- 2. SEÇÃO PRINCIPAL (CONTEÚDO) -->
<section class="py-20 bg-cinza-fundo">
    <div class="container mx-auto px-6">

        <!-- Botão Voltar -->
        {% if last_search_url %}
        <a href="{{ last_search_url }}" class="inline-flex items-center text-marinho hover:text-ouro font-medium mb-8 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Voltar para a busca
        </a>
        {% endif %}
        
        <!-- Grid principal (2 colunas: Conteúdo à esquerda, Infos à direita) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">

            <!-- Coluna da Esquerda: DESCRIÇÃO, FOTOS E CARACTERÍSTICAS -->
            <div class="lg:col-span-2">
                
                <!-- Descrição (Movido para cima) -->
                <div class="bg-white p-8 rounded-lg shadow-xl mb-10">
                    <h3 class="font-serif text-3xl text-marinho font-bold mb-5">Descrição</h3>
                    <div class="prose prose-lg max-w-none text-graphite">
                        {{ imovel.descricao|linebreaks }}
                    </div>
                </div>

                <!-- Imagem Principal (Hero) -->
                <div class="bg-white rounded-lg shadow-xl overflow-hidden mb-4">
                    {% if imovel.imagem_principal %}
                        <img src="{{ imovel.imagem_principal.url }}" alt="Foto principal de {{ imovel.titulo }}" class="w-full h-auto object-cover">
                    {% else %}
                        <img src="https://placehold.co/1200x800/142048/FFF?text=Lotus+Imobili%C3%A1ria" alt="Sem foto" class="w-full h-auto object-cover">
                    {% endif %}
                </div>

                <!-- Galeria Secundária (Thumbnails) -->
                <h3 class="font-serif text-2xl text-marinho font-bold mt-10 mb-4">Galeria de Imagens</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="gallery--getting-started">
                    {% for img in imovel.imagens_secundarias.all %}
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden transition-all duration-300 hover:scale-105">
                            <a href="{{ img.imagem.url }}"
                               data-pswp-width="{{ img.imagem.width }}"
                               data-pswp-height="{{ img.imagem.height }}">
                                <img src="{{ img.imagem.url }}" alt="Galeria de {{ imovel.titulo }}" class="w-full h-40 object-cover">
                            </a>
                        </div>
                    {% empty %}
                        <p class="text-graphite/70 col-span-4">Este imóvel não possui galeria de imagens secundárias.</p>
                    {% endfor %}
                </div>

                <!-- Características (XML <Features>) -->
                {% if imovel.caracteristicas.all %}
                <div class="bg-white p-8 rounded-lg shadow-xl mt-10">
                    <h3 class="font-serif text-3xl text-marinho font-bold mb-6">Características do Imóvel</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        {% for f in imovel.caracteristicas.all %}
                        <div class="flex items-center">
                            <svg class="h-5 w-5 text-ouro mr-2 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            <span class="text-graphite">{{ f.nome }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Coluna da Direita: INFORMAÇÕES E PREÇO (Sticky) -->
            <aside class="lg:col-span-1 lg:sticky top-28 h-fit">
                <div class="bg-white p-6 rounded-lg shadow-xl">
                    
                    <!-- Preço -->
                    {% if imovel.valor %}
                        <p class="font-serif text-4xl text-marinho-claro font-bold">
                            R$ {{ imovel.valor|intcomma }}
                        </p>
                    {% else %}
                        <p class="font-serif text-3xl text-marinho-claro font-bold">
                            Sob Consulta
                        </p>
                    {% endif %}
                    
                    <!-- Botão de Ação (Agendar Visita) -->
                    <a href="{{ whatsapp_url }}" target="_blank" class="mt-5 flex items-center justify-center w-full text-center bg-green-500 text-white font-medium px-5 py-4 rounded-lg shadow-lg hover:bg-green-600 transition duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.894 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.886-.001 2.269.655 4.398 1.919 6.191l-.84 3.095 3.147-.817z"/></svg>
                        Agende uma visita
                    </a>

                    <!-- Tabela de Especificações -->
                    <h3 class="font-serif text-xl text-marinho font-bold mt-6 mb-4 border-t pt-4">Especificações</h3>
                    <div class="space-y-3 text-graphite">
                        
                        {% if imovel.area_util %}
                        <div class="flex justify-between border-b pb-2">
                            <span class="font-medium">Área Útil</span>
                            <span class="font-bold">{{ imovel.area_util|intcomma }} m²</span>
                        </div>
                        {% endif %}
                        
                        {% if imovel.quartos %}
                        <div class="flex justify-between border-b pb-2">
                            <span class="font-medium">Quartos</span>
                            <span class="font-bold">{{ imovel.quartos }}</span>
                        </div>
                        {% endif %}

                        {% if imovel.suites %}
                        <div class="flex justify-between border-b pb-2">
                            <span class="font-medium">Suítes</span>
                            <span class="font-bold">{{ imovel.suites }}</span>
                        </div>
                        {% endif %}

                        {% if imovel.banheiros %}
                        <div class="flex justify-between border-b pb-2">
                            <span class="font-medium">Banheiros</span>
                            <span class="font-bold">{{ imovel.banheiros }}</span>
                        </div>
                        {% endif %}

                        {% if imovel.vagas %}
                        <div class="flex justify-between border-b pb-2">
                            <span class="font-medium">Vagas</span>
                            <span class="font-bold">{{ imovel.vagas }}</span>
                        </div>
                        {% endif %}

                        {% if imovel.andar %}
                        <div class="flex justify-between border-b pb-2">
                            <span class="font-medium">Andar</span>
                            <span class="font-bold">{{ imovel.andar }}º</span>
                        </div>
                        {% endif %}

                        {% if imovel.taxa_condominio %}
                        <div class="flex justify-between border-b pb-2">
                            <span class="font-medium">Condomínio</span>
                            <span class="font-bold">R$ {{ imovel.taxa_condominio|intcomma }}</span>
                        </div>
                        {% endif %}

                        {% if imovel.iptu %}
                        <div class="flex justify-between border-b pb-2">
                            <span class="font-medium">IPTU (Anual)</span>
                            <span class="font-bold">R$ {{ imovel.iptu|intcomma }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </aside>

        </div>
    </div>
</section>

{% endblock %}
